!function(e,t){if("function"==typeof define&&define.amd){var n=["lodash","jquery","khoaijs","khoaijs-event-emitter"];define(n,function(n,r,o,i){var s=Array.prototype.slice.call(arguments),a=t.apply(null,s);return o.Component=a,e.Component=a,a})}else{var r=t(e._,e.jQuery,e.Khoai,e.Khoai.EventEmitter||e.EventEmitter);e.Khoai.Component=r,e.Component=r}}(this,function(e,t,n,r){function o(){return n.util.nextID("component_",!0)}function i(e){r.call(this),this.id=o(),this.name=e,this.options={},this.render_handler=null,this.value_handler=null,this.is_rendered=!1,this.stores={},this.store_field=null,this.store_data_handler=null}function s(e,t,n){var r=l[e],o=new r(t);return o.name=t,n&&o.option(n),o}function a(t,n,r){var o,s=u[t];return o=s.base_on?i.factory(s.base_on,n):new i(name),!e.isEmpty(s.properties)&&e.isObject(s.properties)&&e.extend(o,s.properties),s.hasOwnProperty("options")&&o.option(s.options),s.hasOwnProperty("render_handler")&&s.render_handler&&(o.render_handler=s.render_handler.bind(o)),s.hasOwnProperty("detail.value_handler")&&s.value_handler&&(o.value_handler=s.value_handler.bind(o)),s.reset_events&&(e.isArray(s.reset_events)?o._events=e.omit(o._events,s.reset_events):o._events={}),s.events&&e.each(s.events,function(e,t){o.on(t,e)}),s.methods&&e.each(s.methods,function(e,t){o[t]=e.bind(o)}),s.init_handler&&s.init_handler(o),r&&o.option(r),o}function p(n){var r,s,a,p,d=t(n),l=d.data(),u={},f=!0,m=["comp","compName","compOptions","compStore","compInit","compRenderReplace"];if((r=l.comp)&&!i.isRegistered(r)&&!i.isDefined(r))throw c(d),new Error("[Component.Fill] Component class is not defined: "+r);var v=l.compName||l.name||d.attr("name");if(v||(v=o()),s=i.factory(r||"Component",v),d.attr("id",s.id),l.hasOwnProperty("compOptions")&&(e.isString(l.compOptions)&&(u=window[l.compOptions])&&e.isFunction(l.compOptions)&&(u=l.compOptions()),!e.isObject(u)))throw c(d),new Error("[Component.Fill] Component options must be an object or function that return an object, #"+s.id);var y=h(s.options,l,m);if(e.extend(u,y),e.isEmpty(u)||s.option(u),p=l.compStore){if(p=window[p],!e.isObject(p))throw c(d),new Error("[Component.Fill] Component store must be an object, #"+s.id);s.connectStore(p)}if(a=l.compInit){if(a=window[a],!e.isFunction(a))throw c(d),new Error("[Component.Fill] Component init handler must be an function, #"+s.id);a(s)}return l.hasOwnProperty("compRenderReplace")&&(f=!e.isEmpty(e.compact([l.compRenderReplace]))),{component:s,renderReplace:f}}function c(e){console.warn("[Component.Fill] Failed at",e)}function h(t,n,r){r=r||[];var o=e.difference(Object.keys(n),r),i=e.filter(o,function(t){return e.startsWith(t,"compOp")});if(e.isEmpty(i))return{};var s={};e.each(i,function(t){var r=t.slice(6).trim(),o=d(n[t]);r&&(s[r.toLowerCase()]=o,s[e.camelCase(r)]=o,s[e.snakeCase(r)]=o)});var a=e.pick(s,e.intersection(e.keys(s),e.keys(t)));return e.isEmpty(a)?{}:a}function d(e){try{return JSON.parse(e)}catch(e){}return e}var l={},u={};return n.util.inherit(i,r),i.prototype.trigger=i.prototype.emitEvent,i.prototype.option=function(t,r){return this.options=n.util.setup.apply(null,[this.options].concat(e.toArray(arguments))),this.emitEvent("option_changed"),this},i.prototype.getOptions=function(){return e.cloneDeef(this.options)},i.prototype.compile=function(){var t;return t=e.isFunction(this.render_handler)?this.render_handler.bind(this)(this):String(this.render_handler),this.emitEvent("compiled",t),t},i.prototype.rendered=function(){this.is_rendered=!0,this.emitEvent("rendered")},i.prototype.render=function(n,r){this.is_rendered&&this.remove();var o=this.compile();return n=t(n),e.isUndefined(r)||r?n.replaceWith(o):n.html(o),this.getContainer().data("component",this),this.rendered(),this},i.prototype.handleHolder=function(e){},i.prototype.reRender=function(){if(!this.is_rendered)throw new Error("Component is not rendered");var e=this.compile();return this.emitEvent("before_re_render"),this.is_rendered=!1,this.getContainer().replaceWith(e).data("component",this),this.rendered(),this.emitEvent("re-rendered"),this},i.prototype.getValue=function(){return e.isFunction(this.value_handler)?this.value_handler(this):null},i.prototype.getContainer=function(n){var r=t("#"+this.id);if(!r.length){if(n||e.isUndefined(n))throw new Error("Get component DOM failed: #"+this.id+", name: "+(this.name||""));return null}return r},i.prototype.remove=function(){var e=this.getContainer();e.length&&(this.emitEvent("before_remove"),e.remove(),this.is_rendered=!1,this.emitEvent("removed"))},i.prototype.connectStore=function(e){var t=e.getStoreKey();return this.stores[t]=e,this.emitEvent("connect_store",t,e),this},i.prototype.disconnectStore=function(e){var t=e.getStoreKey();return delete this.stores[t],this.emitEvent("disconnect_store",e),this},i.prototype.pushToStores=function(t){var n,r=this.store_field||this.name||this.id,o={};if(!r)throw new Error("Store data field is undefined");e.isEmpty(this.stores)||(n=this.getValue(),e.isFunction(this.store_data_handler)&&(n=this.store_data_handler(n,this)),o[r]=n,e.each(this.stores,function(e){e[t?"changeSilent":"change"](o)}))},i.register=function(e,t){l[e]=t},i.isRegistered=function(e){return l.hasOwnProperty(e)},i.unRegister=function(e){delete l[e]},i.isDefined=function(e){return u.hasOwnProperty(e)},i.unDefine=function(e){delete u[e]},i.define=function(t,n,r){if(r&&!l.hasOwnProperty(r)&&!u.hasOwnProperty(r))throw new Error("Base class or extend is not defined: "+r);if(i.isRegistered(t))throw new Error("Component type name is registered by another component class: "+t);u[t]=e.extend({base_on:r,init_handler:null,options:{},properties:{},render_handler:null,reset_events:!1,events:{},methods:{},value_handler:null},n)},i.factory=function(t,n,r){if(!e.isString(n))throw new Error("Component name is missing or invalid");if(l.hasOwnProperty(t))return s(t,n,r);if(u.hasOwnProperty(t))return a(t,n,r);throw new Error("Component class not found: "+t)},i.classes=function(){return Object.keys(l)},i.defined=function(){return Object.keys(u)},i.fill=function(e){if(e=t(e),!e.length)return null;e=e.first();var n=p(e);return n.component.handleHolder(e),n.component.render(e,n.renderReplace)},i.fills=function(e){var n=t(e),r=[];return n.each(function(e,t){r.push(i.fill(t))}),r},i.register("Component",i),i.connectStore=function(t,n){n=Array.prototype.slice.call(arguments,1),e.each(n,function(e){e.connectStore(t)})},t.fn.component=function(e){return this.each(function(){i.fill(t(this))})},i});
//# sourceMappingURL=component.min.js.map
